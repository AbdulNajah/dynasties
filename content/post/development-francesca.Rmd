---
title: "General elections 2019"
author: ""
date: "2020-06-27"
output:
  blogdown::html_page:
    toc: true
editor_options: 
  chunk_output_type: inline
---
```{r set up, warning=FALSE, include=FALSE, message= FALSE}
# Do not edit this code block/chunk
knitr::opts_chunk$set(cache = FALSE,echo = FALSE, message=FALSE, warning = FALSE)

##fig.width = 16/2, fig.height = 9/2

library(tidyverse)
library(data.table)
library(knitr)
library(kableExtra)
library(scales)
library(gridExtra)
library(stargazer)
`%!in%` = Negate(`%in%`)
```



<!-- ```{r file config} -->


<!-- dyn <- read.csv("D:/cpr/up-dynasties/dyn_other_data/dyn_ae_ge.csv") -->


<!-- dyn <- dyn %>%  filter(year %!in% c(1974)) -->

<!-- #summary(nrega) -->

<!-- dyn$dyn_cum_text <- ifelse(dyn$dyn_cum ==0, "Non-family","Family") -->

<!-- dyn$fam_rel_id_uniq <-  paste(dyn$family_id, dyn$rel_id_uniq,sep = "") -->


<!-- dyn$fam_exp_cum_cat <- factor(dyn$fam_exp_cum_cat, levels=c("[0,1)","[1,6)","[6,11)","[11,21)","[21,Inf]")) -->

<!-- ###four way elections -->


<!-- dyn_test <- dyn %>% mutate(contest_type_1 =case_when(position ==1 &dyn_cum ==0 ~1, -->
<!--                                                                                                                         position ==2 &dyn_cum ==0 ~2, -->
<!--                                                                                                                         position ==1 &dyn_cum ==1 ~3, -->
<!--                                                                                                                         position ==2 &dyn_cum ==1 ~5)) %>% group_by( election_type,year,constituency_no) %>% mutate(sum_cont_type = sum(contest_type_1)) %>% mutate(contest_type =ifelse(sum_cont_type ==3, "non-fam v/s non-fam",ifelse(sum_cont_type ==5, "fam v/s non-fam", ifelse(sum_cont_type ==6, "non-fam v/s fam", ifelse(sum_cont_type ==8, "fam v/s fam", "NA"))))) -->


<!-- # dyn_test %>% group_by( year,constituency_no) %>% summarise(sum = sum(contest_type)) %>%group_by(sum) %>%  summarise(n()) -->

<!-- #table(dyn_test$contest_type) -->

<!-- dyn$contest_type <- dyn_test$contest_type -->



<!-- dyn_ae <- dyn %>% filter(election_type =="AE") -->


<!-- dyn_ge <- dyn %>% filter(election_type =="GE") -->


<!-- ``` -->

<!-- # Dasgupta -->


<!-- ```{r} -->

<!-- dasgupta <- read.csv("D:/cpr/up-dynasties/dyn_other_data/dasguptatablepaper.csv") -->


<!-- ``` -->





<!-- ```{r} -->
<!-- tcpd <- read.csv("D:/cpr/up-dynasties/dyn_other_data/TCPD_2019_all_candidates_with_caste_and_political_family.csv") -->

<!-- tcpd <- read.csv("") -->


<!-- ge_all <- fread("D:/cpr/up-dynasties/dyn_other_data/tcpd_ge_2019_all.csv") -->

<!-- ge_tc <- ge_all %>% select(State_Name, Constituency_No, Position,Poll_No, Turncoat) %>% rename(turncoat_true = Turncoat) -->

<!-- tcpd <- merge(tcpd, ge_tc, by = c("State_Name", "Constituency_No", "Position", "Poll_No"), all.x = TRUE) -->


<!-- tcpd_5 <- tcpd %>% filter(Vote_Share_Percentage >5) -->

<!-- tcpd_2 <- tcpd %>% filter(Vote_Share_Percentage >2) -->

<!-- tcpd_10 <- tcpd %>% filter(Vote_Share_Percentage >10) -->

<!-- tcpd_1 <- tcpd %>% filter(Vote_Share_Percentage >1) -->

<!-- tcpd_5 <- read.csv("D:/cpr/up-dynasties/dyn_other_data/tcpd_ge_19_VS_corrected.csv") -->


<!-- dynast  <- replace_na(tcpd_5$dynast,0) -->

<!-- incumbent <- tcpd_5$Incumbent -->

<!-- recontest <- tcpd_5$Recontest -->

<!-- bjp <- ifelse(tcpd_5$Party == "BJP",1,0) -->

<!-- sex <- tcpd_5$Sex -->

<!-- turncoat <- ifelse(tcpd_5$turncoat_true == "TRUE", "TRUE", "FALSE") %>% replace_na("FALSE") -->

<!-- serious_case <- tcpd_5$MyNeta_serious_criminal_cases -->

<!-- education <- case_when(str_detect(tcpd_5$MyNeta_education, "(Pass)| (Others) | (Literate) | (Illiterate)") ~ "Basic", -->
<!--                        TRUE ~ "Higher") -->


<!-- caste <- case_when(str_detect(tcpd_5$Caste_Rec, "(CHRISTIAN)|(SIKH)|(BUDDHIST)") ~"Other religious", -->
<!--                    str_detect(tcpd_5$Caste_Rec, "(UC)|(IC)|(OBC)|(SC)|(ST)|(Muslim)") ~"XMain", -->
<!--                    TRUE ~"Others") -->


<!-- enop <- tcpd_5$ENOP -->

<!-- vote_share_pc <- tcpd_5$Vote_Share_Percentage -->

<!-- contest <- tcpd_5$Contested -->

<!-- terms <- tcpd_5$No_Terms -->


<!-- assets <- tcpd_5$MyNeta_assets -->

<!-- winner <- ifelse(tcpd_5$Position ==1, 1,0) -->

<!-- age <- tcpd_5$MyNeta_age -->

<!-- #  -->
<!-- # UC, IC, OBC, SC, ST, Muslim (all), Other Religious (all Sikh, all Christian, all Buddhist), Others -->
<!-- #  -->




<!-- ``` -->


```{r}


tcpd_5 <- read.csv("D:/cpr/up-dynasties/dyn_other_data/tcpd_ge_19_VS_corrected.csv")


dynast  <-tcpd_5$dynast

incumbent <- tcpd_5$Incumbent

recontest <- tcpd_5$Recontest

bjp <- tcpd_5$bjp

sex <- tcpd_5$Sex

turncoat <- tcpd_5$turncoat

serious_case <- tcpd_5$serious_case

education <- tcpd_5$education

caste <-  case_when(str_detect(tcpd_5$Caste_Rec, "(UC)|(IC)") ~"UC+IC",
                   TRUE ~"Others")




enop <- tcpd_5$ENOP

vote_share_pc <- tcpd_5$Vote_Share_Percentage

contest <- tcpd_5$Contested

terms <- tcpd_5$No_Terms


assets <- tcpd_5$MyNeta_assets

winner <- tcpd_5$winner

age <- tcpd_5$MyNeta_age


reservation <- ifelse(tcpd_5$Constituency_Type == "GEN","GEN" ,"SC/ST")

turnout <- tcpd_5$Turnout_Percentage



```

# GE 2019 summary

```{r}

table <- tcpd_5 %>% group_by(dynast) %>% summarise(Vote_Share = mean(Vote_Share_Percentage),
                                          Margin_ = mean(Margin_Percentage),
                                          N_cand = mean(N_Cand),
                                          enop = mean(ENOP),
                                          Turnout = mean(Turnout_Percentage),
                                          Incumbent = mean(Incumbent),
                                          Recontest = mean(Recontest),
                                          Contests = mean(Contested),
                                          No_terms = mean(No_Terms),
                                          Turncoat = mean(turncoat),
                                          Assets = mean(assets,na.rm =TRUE), 
                                          criminal_cases = mean(MyNeta_serious_criminal_cases,na.rm =TRUE),
                                          criminal_cases_no = mean(MyNeta_criminal_cases, na.rm =TRUE), 
                                          age = mean(age, na.rm =TRUE),
                                          bjp = mean(bjp))# %>% 
  #kable(digits = 2) %>% kable_styling(bootstrap_options = "striped")


kable(table[,1:9], digits = 2) %>%  kable_styling(bootstrap_options = "striped")
kable(table[,10:16], digits = 2) %>%  kable_styling(bootstrap_options = "striped")


# tcpd_5 %>% group_by(dynast,Sex) %>% summarise(count = n()) %>% group_by(dynast) %>% mutate(sum = sum(count), prop = count/sum) %>% select(dynast, Sex, prop) %>% filter(Sex == "F") %>% kable(digits = 2)

```

<!-- # Vote share linear model -->

```{r linear}
fit <- lm(vote_share_pc ~ bjp +  incumbent+  turncoat +caste+ sex + terms + dynast + assets  + serious_case+ education+age+enop +reservation+ dynast*serious_case)

#ummary(fit)

#stargazer(fit, type = "html")



```


<!-- # Winner probit model -->

```{r logistic, results = "asis"}



fit_logit <- glm(winner ~bjp +  incumbent+  turncoat +caste+ sex + terms + dynast + assets  + serious_case+ education+age+enop +reservation+ dynast*serious_case,family =  binomial(link = "probit"))


#summary(fit_logit)



```

<!-- # Turnout linear model -->

# Regressions


```{r turnout, results = "asis"}

fit_turnout <-  lm(turnout ~ bjp +  incumbent+  turncoat +caste+ sex + terms + dynast + assets  + serious_case+ education+age+enop +reservation+ dynast*serious_case)

#summary(fit_turnout)

stargazer(fit, fit_logit, fit_turnout,omit = c("bjp" ), title="Regression Results",type = "html",
align=TRUE, dep.var.labels=c("Vote share percentage","Winner", "Turnout percentage"),
omit.stat=c("LL","ser","f"), no.space=TRUE)


```





<!-- ```{r} -->

<!-- tcpd_5$dynast  <- replace_na(tcpd_5$dynast,0) -->

<!-- tcpd_5$incumbent <- tcpd_5$Incumbent -->

<!-- recontest <- tcpd_5$Recontest -->

<!-- tcpd_5$bjp <- ifelse(tcpd_5$Party == "BJP",1,0) -->

<!-- tcpd_5$sex <- tcpd_5$Sex -->

<!-- tcpd_5$turncoat <- ifelse(tcpd_5$turncoat_true == "TRUE", "TRUE", "FALSE") %>% replace_na("FALSE") -->

<!-- tcpd_5$serious_case <- tcpd_5$MyNeta_serious_criminal_cases -->

<!-- tcpd_5$education <- case_when(str_detect(tcpd_5$MyNeta_education, "(Pass)| (Others) | (Literate) | (Illiterate)") ~ "Basic", -->
<!--                        TRUE ~ "Higher") -->


<!-- tcpd_5$caste <- case_when(str_detect(tcpd_5$Caste_Rec, "(CHRISTIAN)|(SIKH)|(BUDDHIST)") ~"Other religious", -->
<!--                    str_detect(tcpd_5$Caste_Rec, "(UC)|(IC)|(OBC)|(SC)|(ST)|(Muslim)") ~"XMain", -->
<!--                    TRUE ~"Others") -->


<!-- enop <- tcpd_5$ENOP -->

<!-- tcpd_5$vote_share_pc <- tcpd_5$Vote_Share_Percentage -->

<!-- contest <- tcpd_5$Contested -->

<!-- tcpd_5$terms <- tcpd_5$No_Terms -->


<!-- tcpd_5$assets <- tcpd_5$MyNeta_assets -->

<!-- tcpd_5$winner <- ifelse(tcpd_5$Position ==1, 1,0) -->

<!-- tcpd_5$age <- tcpd_5$MyNeta_age -->


<!-- write.csv(tcpd_5, "D:/cpr/up-dynasties/dyn_other_data/tcpd_ge_19_VS_5PC.csv") -->
<!-- ``` -->



```{r}




```






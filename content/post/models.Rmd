---
title: "Models"
author: ""
date: "2020-07-16"
output:
  blogdown::html_page:
    toc: true
editor_options: 
  chunk_output_type: inline
---
```{r set up, warning=FALSE, include=FALSE, message= FALSE}
# Do not edit this code block/chunk
knitr::opts_chunk$set(cache = FALSE,echo = FALSE, message=FALSE, warning = FALSE)

##fig.width = 16/2, fig.height = 9/2

library(tidyverse)
library(data.table)
library(knitr)
library(kableExtra)
library(scales)
library(gridExtra)
library(stargazer)
`%!in%` = Negate(`%in%`)
```





```{r}

dyn_all <- read.csv("D:/cpr/up-dynasties/dyn_other_data/dyn_all.csv")

dyn_all_uniq <- dyn_all %>% filter(family_id != "") %>% group_by(family_id) %>% arrange(-year) %>% distinct(family_id, .keep_all= TRUE)

#dyn_all_uniq %>% filter(str_detect( patriarch_name,"Mulayam Singh"))




```


```{r}

## Industries

dyn_indus <- read.csv("D:/cpr/up-dynasties/ae_ge_indus.csv")

dyn_indus <- dyn_indus %>% filter(ï..election_type %in% c("AE", "GE"))


dyn_indus <- dyn_indus %>% mutate(indus_2 = ifelse(indus_2>0,indus_2,0), indus_3 = ifelse(indus_3>0,indus_2,0),indus_4 = ifelse(indus_4>0,indus_4,0)) %>% select(ï..election_type,year, pid, indus_2, indus_3, indus_4)

names(dyn_indus)[1] <- "election_type"

dyn_ae_ge <- dyn_all %>% filter(election_type %in% c("AE", "GE"))

dyn_ae_ge <- merge(dyn_ae_ge, dyn_indus, by = c("election_type", "year", "pid"))

dyn_ae_ge <- dyn_ae_ge %>% mutate(indus_2_c = ifelse(indus_2>0,1,0),indus_3_c = ifelse(indus_3>0,1,0), indus_4_c = ifelse(indus_4>0,1,0), indus_count = indus_2_c+indus_3_c+ indus_4_c) %>% select(-c(indus_2_c, indus_3_c, indus_4_c))


## cabinet


cabinet <- read.csv("D:/cpr/up-dynasties/dyn_other_data/up_cabinet_01.07.20.csv")

#glimpse(cabinet)

names(cabinet) <- tolower(names(cabinet))

names(cabinet) <- make.unique(names(cabinet))

cabinet <- cabinet %>% rename(year = election_year_1)





cabinet$rel_id_unique <- as.numeric(cabinet$rel_id_unique)

cabinet <- cabinet %>% filter(rel_id_unique >0 )


cabinet <- cabinet %>% mutate(pre_90 = case_when(dplyr::between(year, 1977,1990)~ 1,
                             TRUE ~0), post_90 =case_when(dplyr::between(year, 1990,2017)~ 1,
                             TRUE ~0) )


#table(cabinet$post_90)


dyn_cabinet <-  cabinet  %>% filter(year!= "" & family_id >0 & family_id != "UK") %>% group_by(family_id) %>%summarise(n_sc_minster = n(), minister_dur = sum(term_months, na.rm = TRUE), pre_90_n = sum(pre_90), post_90_n = sum(post_90))

dyn_cabinet$min_dur_yr <- round(dyn_cabinet$minister_dur/12,2)





dyn_ae_ge <- merge(dyn_ae_ge,dyn_cabinet, by ="family_id", allow.cartesian = TRUE, all.x =TRUE )



```

```{r ae-ge}

dyn_ae_ge_uniq <-dyn_ae_ge %>% filter( family_id != "") %>% group_by(family_id) %>% arrange(-year) %>% distinct(family_id, .keep_all= TRUE)

#prop.table(table(dyn_ae_ge_uniq$year)) %>% kable(digits = 2)

dynast <-dyn_ae_ge_uniq$dyn_tot


caste <- dyn_ae_ge_uniq$caste_groups

industries <- dyn_ae_ge_uniq$indus_count

position <- dyn_ae_ge_uniq$position

vote_share <- dyn_ae_ge_uniq$vote_share_percentage

margin <- dyn_ae_ge_uniq$margin_percentage

incumbent <- dyn_ae_ge_uniq$incumbent

turncoat <- dyn_ae_ge_uniq$turncoat

turnout <- dyn_ae_ge_uniq$turnout_percentage




```

## AE All 

```{r ae , results= "asis"}
dyn_ae_uniq <-dyn_ae_ge %>% filter(election_type == "AE"& family_id != "") %>% group_by(family_id) %>% arrange(-year) %>% distinct(family_id, .keep_all= TRUE)


dynast <-dyn_ae_uniq$dyn_tot


caste <- dyn_ae_uniq$caste_groups

industry <- dyn_ae_uniq$indus_count

position <- dyn_ae_uniq$position

caste_uc <- ifelse(dyn_ae_uniq$caste_groups == "Upper Caste", TRUE,FALSE)

winner <- ifelse(dyn_ae_uniq$position==1,1,0)

vote_share <- dyn_ae_uniq$vote_share_percentage

margin <- dyn_ae_uniq$margin_percentage

incumbent <- dyn_ae_uniq$incumbent

turncoat <- dyn_ae_uniq$turncoat

turnout <- dyn_ae_uniq$turnout_percentage


N_minister <- dyn_ae_uniq$n_sc_minster%>% replace_na(0)

minister_duration <- dyn_ae_uniq$min_dur_yr %>% replace_na(0)


pre_90 <- ifelse(dyn_ae_uniq$pre_90_n >0,1,0) %>% replace_na(0)

post_90 <- ifelse(dyn_ae_uniq$post_90_n >0,1,0) %>% replace_na(0)



decades <- paste(pre_90, post_90, sep = "")

decades <- case_when(decades == "00"~ "Never",
                     decades %in% c("11","10")~"Pre-90",
                     TRUE ~ "Post-90")

link <- ifelse(dyn_ae_uniq$level %in% c("AE","GE"),0,1) %>% replace_na(0)




fit.1 <- glm(dynast ~ caste_uc +  industry+ minister_duration  , family = binomial(link = "probit"))


position <- ifelse(position ==1,1,0)

fit.2 <- glm(winner ~ vote_share + dynast + caste_uc + incumbent + turnout + industry + minister_duration + link , family = binomial(link = "probit") )

# summary(fit.1)
# 
# summary(fit.2)



fit.3 <- lm(vote_share ~ dynast + caste_uc +incumbent + turnout + industry + minister_duration + decades + link )

# summary(model_vc)

stargazer(fit.1, fit.2,fit.3,title="AE all - Regression Results",type = "html",omit.stat=c("LL","ser","f"),
align=TRUE,dep.var.labels=c("Dynast","Winner","Vote share"), no.space=TRUE)


```

## GE All

```{r ge  , results= "asis"}
dyn_ge_uniq <-dyn_ae_ge %>% filter(election_type == "GE"& family_id != "") %>% group_by(family_id) %>% arrange(-year) %>% distinct(family_id, .keep_all= TRUE)


dynast <-dyn_ge_uniq$dyn_tot



caste <- dyn_ge_uniq$caste_groups

industry <- dyn_ge_uniq$indus_count

position <- dyn_ge_uniq$position

vote_share <- dyn_ge_uniq$vote_share_percentage

#margin <- dyn_ge_uniq$margin_percentage

incumbent <- dyn_ge_uniq$incumbent

turncoat <- dyn_ge_uniq$turncoat

turnout1 <- dyn_ge_uniq$turnout_percentage

caste_uc <- ifelse(dyn_ge_uniq$caste_groups == "Upper Caste", TRUE,FALSE)

winner <- ifelse(dyn_ge_uniq$position==1,1,0)

# 
# N_minister <- dyn_ge_uniq$n_sc_minster%>% replace_na(0)
# 
 minister_duration <- dyn_ge_uniq$min_dur_yr %>% replace_na(0)
# 
# 
# pre_90 <- ifelse(dyn_ge_uniq$pre_90_n >0,1,0) %>% replace_na(0)
# 
# post_90 <- ifelse(dyn_ge_uniq$post_90_n >0,1,0) %>% replace_na(0)
# 
# 
# 
# decades <- paste(pre_90, post_90, sep = "")
# 
# decades <- case_when(decades == "00"~ "Never",
#                      decades %in% c("11","10")~"Pre-90",
#                      TRUE ~ "Post-90")

link <- ifelse(dyn_ge_uniq$level %in% c("AE","GE"),0,1) %>% replace_na(0)



#fit.1 <- glm(dynast ~ caste + link + industry+ minister_duration  , family = binomial(link = "probit"))


position <- ifelse(position ==1,1,0)

fit.1 <- glm(dynast ~ caste_uc +  industry+ minister_duration  , family = binomial(link = "probit"))



fit.2 <- glm(winner ~ vote_share + dynast + caste_uc + incumbent + turnout1 +turncoat+ industry + link , family = binomial(link = "probit") )
# 
# summary(fit.1)


fit.3 <- lm(vote_share ~ dynast + caste_uc +incumbent + turnout1 + industry + link+ turncoat)

# summary(fit.2)

stargazer(fit.1, fit.2,fit.3,title=" GE all - Regression Results",type = "html",
align=TRUE,dep.var.labels=c("Dynast","Winner","Vote share"),
omit.stat=c("LL","ser","f"), no.space=TRUE)


```




```{r adr}

adr <- read.csv("D:/cpr/up-dynasties/dyn_other_data/adr_candidatelevel.csv", stringsAsFactors = FALSE)

names(adr)[1] <- "position"

names(adr) <- tolower(names(adr))

adr <- adr %>% select( -constituency_id,-state,-         assembly_no,-              
 month,-              poll_no,-           
 delimid,-            position,-          
candidate,-          sex,-               
party,-              votes,-             
 candidate_type,-     valid_votes,-       
 electors,-           constituency_name,- 
 constituency_type,-  sub_region,-        
 n_cand,-             turnout_percentage,-
 vote_share_percentage,-     deposit_lost,-      
margin,-             margin_percentage,- 

enop,-              
 pid,-                max_poll_no,-       
 last_poll,-          contested,-         
 last_party,-         last_constituency_name,-                     
same_constituency,-  same_party,-        
 no_terms,-           turncoat,-          
incumbent,-          recontest   )

adr <- adr %>% filter(position_tcpd %in% c(1,2))

adr <- adr %>% rename( position = position_tcpd)

#uniqueN(adr$position)



# dim(adr)
# 
# adr %>% glimpse()
# 
# unique(adr$year)
# 
# summary(adr)
# names(adr)




dyn_ae_ge <- merge(dyn_ae_ge,adr, by = c("year", "constituency_no", "position"))


names(dyn_ae_ge ) <- make.unique(names(dyn_ae_ge ))

dyn_ae_ge $total_assets <- as.numeric(dyn_ae_ge $total_assets)

#dyn_adr$fam_exp_cum_cat <- factor(dyn_adr$fam_exp_cum_cat, levels=c("[0,1)","[1,6)","[6,11)","[11,21)","[21,Inf]"))


#dyn_adr$year <- factor(dyn_adr$year, levels = c("2009", "2012","2014","2017","2019"))

#dyn_adr$fam_rel_id_uniq <-  paste(dyn_adr$family_id, dyn_adr$rel_id_uniq,sep = "")

# dyn_adr$dyn_cum_text <- ifelse(dyn_adr$dyn_cum ==0, "Non-family","Family")
# 
# dyn_adr_ge <- dyn_adr %>% filter(election_type == "GE")
# 
# dyn_adr_ae <- dyn_adr %>% filter(election_type == "AE")
```

## AE-GE combined


```{r AE GE combined, results="asis"}

dyn_ae_ge_09_19 <- dyn_ae_ge %>% filter(year > 2008)


dynast <-dyn_ae_ge_09_19$dyn_cum


caste <- dyn_ae_ge_09_19$caste_groups

caste_uc <- ifelse(dyn_ae_ge_09_19$caste_groups == "Upper Caste", TRUE,FALSE)

winner <- ifelse(dyn_ae_ge_09_19$position==1,1,0)

industry <- dyn_ae_ge_09_19$indus_count

position <- dyn_ae_ge_09_19$position

vote_share <- dyn_ae_ge_09_19$vote_share_percentage

margin <- dyn_ae_ge_09_19$margin_percentage

incumbent <- dyn_ae_ge_09_19$incumbent

turncoat <- dyn_ae_ge_09_19$turncoat

turnout <- dyn_ae_ge_09_19$turnout_percentage


# N_minister <- dyn_ae_ge_09_19$n_sc_minster%>% replace_na(0)
# 
minister_duration <- dyn_ae_ge_09_19$min_dur_yr %>% replace_na(0)
# 
# 
# pre_90 <- ifelse(dyn_ae_ge_09_19$pre_90_n >0,1,0) %>% replace_na(0)
# 
# post_90 <- ifelse(dyn_ae_ge_09_19$post_90_n >0,1,0) %>% replace_na(0)
# 
# 
# 
# decades <- paste(pre_90, post_90, sep = "")
# 
# decades <- case_when(decades == "00"~ "Never",
#                      decades %in% c("11","10")~"Pre-90",
#                      TRUE ~ "Post-90")

link <- ifelse(dyn_ae_ge_09_19$level %in% c("AE","GE"),0,1) %>% replace_na(0)


movable_assets <- dyn_ae_ge_09_19$total_movable_assets_totals


immovable_assets <- dyn_ae_ge_09_19$total_immovable_assets_totals

total_assets <- dyn_ae_ge_09_19$total_assets



serious_crime <- ifelse(dyn_ae_ge_09_19$serious_crime>0, TRUE, FALSE)

non_serious_crime <- ifelse(dyn_ae_ge_09_19$non_serious_crime>0, TRUE, FALSE)


fit.1 <- glm(dynast ~ caste_uc + winner + turnout + industry + incumbent + turncoat +  serious_crime + non_serious_crime + total_assets )




fit.2 <- glm(winner ~ caste_uc + vote_share+ turnout + industry + incumbent + turncoat + link + serious_crime + non_serious_crime + dynast + total_assets, family = binomial(link = "probit"))

#summary(fit.3)

fit.3 <- lm(vote_share ~ caste_uc +  turnout + industry + incumbent + turncoat + link + serious_crime + non_serious_crime + dynast+total_assets)

# summary(fit.2)


stargazer(fit.1, fit.2,fit.3,title="AE- GE combined  - 2009:19 - Regression Results",type = "html",
align=TRUE,dep.var.labels=c("Dynast","Winner","Vote share"),
omit.stat=c("LL","ser","f"), no.space=TRUE)


```



## AE 2012 -17

```{r ae 2012-2017, results= "asis"}

dyn_ae_12_17 <- dyn_ae_ge %>% filter(year %in% c(2012,2017))


dynast <-dyn_ae_12_17$dyn_cum


caste <- dyn_ae_12_17$caste_groups

caste_uc <- ifelse(dyn_ae_12_17$caste_groups == "Upper Caste", TRUE,FALSE)

winner <- ifelse(dyn_ae_12_17$position==1,1,0)

industry <- dyn_ae_12_17$indus_count

position <- dyn_ae_12_17$position

vote_share <- dyn_ae_12_17$vote_share_percentage

margin <- dyn_ae_12_17$margin_percentage

incumbent <- dyn_ae_12_17$incumbent

turncoat <- dyn_ae_12_17$turncoat

turnout <- dyn_ae_12_17$turnout_percentage


N_minister <- dyn_ae_12_17$n_sc_minster%>% replace_na(0)

minister_duration <- dyn_ae_12_17$min_dur_yr %>% replace_na(0)


pre_90 <- ifelse(dyn_ae_12_17$pre_90_n >0,1,0) %>% replace_na(0)

post_90 <- ifelse(dyn_ae_12_17$post_90_n >0,1,0) %>% replace_na(0)



decades <- paste(pre_90, post_90, sep = "")

decades <- case_when(decades == "00"~ "Never",
                     decades %in% c("11","10")~"Pre-90",
                     TRUE ~ "Post-90")

link <- ifelse(dyn_ae_12_17$level %in% c("AE","GE"),0,1) %>% replace_na(0)


movable_assets <- dyn_ae_12_17$total_movable_assets_totals


immovable_assets <- dyn_ae_12_17$total_immovable_assets_totals

total_assets <- dyn_ae_12_17$total_assets




serious_crime <- ifelse(dyn_ae_12_17$serious_crime>0, TRUE, FALSE)
                  
non_serious_crime <- ifelse(dyn_ae_12_17$non_serious_crime>0, TRUE, FALSE)

position <- ifelse(dyn_ae_12_17$position==1,1,0)

fit.1 <- glm(dynast ~ caste_uc + winner + turnout + vote_share + industry + incumbent + turncoat + link + serious_crime + non_serious_crime + total_assets )

fit.2 <- glm(winner ~ caste_uc + vote_share + turnout + industry + incumbent + turncoat + minister_duration + link + + total_assets+ serious_crime + non_serious_crime + dynast)

# summary(fit.1)

fit.3 <- lm(vote_share ~ caste_uc +  turnout + industry + incumbent + turncoat + minister_duration + link + total_assets + serious_crime + non_serious_crime + dynast)
# 
# summary(fit.2)

stargazer(fit.1, fit.2,fit.3,title="AE - 2012:17 - Regression Results",type = "html",
align=TRUE,dep.var.labels=c("Dynast","Winner","Vote share"),
omit.stat=c("LL","ser","f"), no.space=TRUE)

```

## GE 2009:2019

```{r ge 2009-14-19, results= "asis"}

dyn_ge_09_14_19 <- dyn_ae_ge %>% filter(year %in% c(2009,2014,2019))


dynast <-dyn_ge_09_14_19$dyn_cum


caste <- dyn_ge_09_14_19$caste_groups

caste_uc <- ifelse(dyn_ge_09_14_19$caste_groups == "Upper Caste", TRUE,FALSE)

winner <- ifelse(dyn_ge_09_14_19$position==1,1,0)

industry <- dyn_ge_09_14_19$indus_count

position <- dyn_ge_09_14_19$position

vote_share <- dyn_ge_09_14_19$vote_share_percentage

margin <- dyn_ge_09_14_19$margin_percentage

incumbent <- dyn_ge_09_14_19$incumbent

turncoat <- dyn_ge_09_14_19$turncoat

turnout <- dyn_ge_09_14_19$turnout_percentage


# N_minister <- dyn_ge_09_14_19$n_sc_minster%>% replace_na(0)
# 
# minister_duration <- dyn_ge_09_14_19$min_dur_yr %>% replace_na(0)
# 
# 
# pre_90 <- ifelse(dyn_ge_09_14_19$pre_90_n >0,1,0) %>% replace_na(0)
# 
# post_90 <- ifelse(dyn_ge_09_14_19$post_90_n >0,1,0) %>% replace_na(0)
# 
# 
# 
# decades <- paste(pre_90, post_90, sep = "")
# 
# decades <- case_when(decades == "00"~ "Never",
#                      decades %in% c("11","10")~"Pre-90",
#                      TRUE ~ "Post-90")

link <- ifelse(dyn_ge_09_14_19$level %in% c("AE","GE"),0,1) %>% replace_na(0)


movable_assets <- dyn_ge_09_14_19$total_movable_assets_totals


immovable_assets <- dyn_ge_09_14_19$total_immovable_assets_totals

total_assets <- dyn_ge_09_14_19$total_assets



serious_crime <- ifelse(dyn_ge_09_14_19$serious_crime>0, TRUE, FALSE)

non_serious_crime <- ifelse(dyn_ge_09_14_19$non_serious_crime>0, TRUE, FALSE)

fit.1 <- glm(dynast ~ caste_uc + winner + turnout + industry +vote_share + incumbent + turncoat + link + serious_crime + non_serious_crime + total_assets )



fit.2 <- glm(winner ~ caste_uc + vote_share+ turnout + industry + incumbent + turncoat + link + serious_crime + non_serious_crime + dynast + total_assets, family = binomial(link = "probit"))

#summary(fit.3)

fit.3 <- lm(vote_share ~ caste_uc + turnout + industry + incumbent + turncoat + link + serious_crime + non_serious_crime + dynast+total_assets)

# summary(fit.2)


stargazer(fit.1, fit.2,fit.3,title="GE - 2009:19 - Regression Results",type = "html",
align=TRUE,dep.var.labels=c("Dynast","Winner","Vote share"),
omit.stat=c("LL","ser","f"), no.space=TRUE)

```







